<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pattern Matching Visualizer</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Space Grotesk", sans-serif;
        background: #0a0118;
        color: #e0e7ff;
        min-height: 100vh;
        overflow-x: hidden;
        position: relative;
        transition: background 0.4s, color 0.4s;
      }

      body.light-mode {
        background: #f8fafc;
        color: #0f172a;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at 20% 50%,
            rgba(139, 92, 246, 0.15) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 80%,
            rgba(236, 72, 153, 0.15) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 90%,
            rgba(59, 130, 246, 0.1) 0%,
            transparent 50%
          );
        pointer-events: none;
      }

      .container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 60px 40px;
        position: relative;
        z-index: 1;
      }

      .theme-switcher {
        position: fixed;
        top: 30px;
        right: 40px;
        width: 70px;
        height: 35px;
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid rgba(139, 92, 246, 0.3);
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.4s;
        z-index: 1000;
      }

      .theme-switcher::after {
        content: "üåô";
        position: absolute;
        top: 2px;
        left: 3px;
        width: 27px;
        height: 27px;
        background: linear-gradient(135deg, #8b5cf6, #ec4899);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.4s;
        font-size: 14px;
      }

      body.light-mode .theme-switcher::after {
        content: "‚òÄÔ∏è";
        left: 36px;
      }

      .theme-switcher:hover {
        border-color: rgba(139, 92, 246, 0.6);
        box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
      }

      .masthead {
        text-align: center;
        margin-bottom: 70px;
        position: relative;
      }

      .masthead h1 {
        font-size: 4.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #8b5cf6, #ec4899, #3b82f6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: -0.03em;
        margin-bottom: 15px;
        text-transform: uppercase;
      }

      .masthead .tagline {
        font-size: 1.3rem;
        color: #94a3b8;
        font-weight: 400;
        letter-spacing: 0.05em;
      }

      .mode-selector {
        display: flex;
        gap: 20px;
        margin-bottom: 50px;
        background: rgba(255, 255, 255, 0.02);
        padding: 10px;
        border-radius: 60px;
        border: 1px solid rgba(139, 92, 246, 0.2);
        backdrop-filter: blur(10px);
      }

      .mode-btn {
        flex: 1;
        padding: 22px;
        border: none;
        background: transparent;
        color: #64748b;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        font-family: "Space Grotesk", sans-serif;
        letter-spacing: 0.02em;
      }

      .mode-btn:hover {
        color: #a78bfa;
        transform: scale(1.02);
      }

      .mode-btn.active {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
        box-shadow: 0 10px 40px rgba(139, 92, 246, 0.4);
        transform: scale(1.05);
      }

      .view {
        display: none;
      }

      .view.active {
        display: block;
      }

      .panel {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 30px;
        padding: 40px;
        margin-bottom: 30px;
        backdrop-filter: blur(20px);
        transition: all 0.4s;
        position: relative;
        overflow: hidden;
      }

      body.light-mode .panel {
        background: rgba(255, 255, 255, 0.6);
        border-color: rgba(139, 92, 246, 0.3);
      }

      .panel::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, transparent, #8b5cf6, transparent);
        opacity: 0;
        transition: opacity 0.4s;
      }

      .panel:hover {
        border-color: rgba(139, 92, 246, 0.4);
        box-shadow: 0 20px 60px rgba(139, 92, 246, 0.15);
      }

      .panel:hover::before {
        opacity: 1;
      }

      .dual-input {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
      }

      .field {
        position: relative;
      }

      .field label {
        display: block;
        margin-bottom: 12px;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: #a78bfa;
      }

      .field input {
        width: 100%;
        padding: 18px 24px;
        background: rgba(139, 92, 246, 0.05);
        border: 2px solid rgba(139, 92, 246, 0.2);
        border-radius: 20px;
        color: #e0e7ff;
        font-size: 1.2rem;
        font-family: "Courier New", monospace;
        font-weight: 600;
        transition: all 0.3s;
      }

      body.light-mode .field input {
        color: #0f172a;
        background: rgba(139, 92, 246, 0.08);
      }

      .field input:focus {
        outline: none;
        border-color: #8b5cf6;
        background: rgba(139, 92, 246, 0.1);
        box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
      }

      .field.error input {
        border-color: #ef4444;
        background: rgba(239, 68, 68, 0.1);
      }

      .error-message {
        color: #ef4444;
        font-size: 0.85rem;
        margin-top: 8px;
        display: none;
      }

      .field.error .error-message {
        display: block;
      }

      .toolbar {
        display: flex;
        gap: 20px;
        align-items: center;
        flex-wrap: wrap;
      }

      .algo-picker {
        padding: 16px 28px;
        background: rgba(139, 92, 246, 0.1);
        border: 2px solid rgba(139, 92, 246, 0.3);
        border-radius: 50px;
        color: #e0e7ff;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        font-family: "Space Grotesk", sans-serif;
        transition: all 0.3s;
      }

      body.light-mode .algo-picker {
        color: #0f172a;
      }

      .algo-picker:focus {
        outline: none;
        border-color: #8b5cf6;
      }

      .algo-picker option {
        background: #1e1b4b;
        color: white;
      }

      .action-btn {
        padding: 16px 32px;
        border: none;
        border-radius: 50px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        font-family: "Space Grotesk", sans-serif;
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .action-btn:hover {
        transform: translateY(-4px);
      }

      .action-btn:active {
        transform: translateY(-2px);
      }

      .action-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .btn-run {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
      }

      .btn-halt {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
        box-shadow: 0 10px 30px rgba(245, 158, 11, 0.3);
      }

      .btn-next {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
      }

      .btn-restart {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
        box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
      }

      .velocity-control {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-left: auto;
        padding: 12px 24px;
        background: rgba(139, 92, 246, 0.05);
        border-radius: 50px;
        border: 1px solid rgba(139, 92, 246, 0.2);
      }

      .velocity-control label {
        font-size: 0.9rem;
        font-weight: 600;
        color: #a78bfa;
      }

      .velocity-control input {
        width: 140px;
      }

      .velocity-display {
        font-weight: 700;
        color: #8b5cf6;
        min-width: 55px;
      }

      .stage {
        padding: 60px 40px;
        min-height: 350px;
      }

      .sequence {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 70px;
        flex-wrap: wrap;
        font-family: "Courier New", monospace;
        position: relative;
      }

      .pattern-overlay {
        position: absolute;
        top: 80px;
        left: 0;
        right: 0;
        display: flex;
        justify-content: center;
        gap: 10px;
        pointer-events: none;
      }

      .pattern-shift-indicator {
        position: absolute;
        top: -40px;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, transparent, #8b5cf6, transparent);
        opacity: 0;
        transition: opacity 0.3s;
      }

      .pattern-shift-indicator.active {
        opacity: 1;
      }

      .token {
        width: 55px;
        height: 65px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.6rem;
        font-weight: 700;
        position: relative;
        transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        background: rgba(255, 255, 255, 0.03);
        clip-path: polygon(
          10% 0%,
          90% 0%,
          100% 25%,
          100% 75%,
          90% 100%,
          10% 100%,
          0% 75%,
          0% 25%
        );
      }

      body.light-mode .token {
        background: rgba(139, 92, 246, 0.08);
        color: #0f172a;
      }

      .token .pos {
        position: absolute;
        bottom: -28px;
        font-size: 0.75rem;
        color: #64748b;
        font-weight: 600;
      }

      .token.active {
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: #1e293b;
        transform: scale(1.2) rotate(5deg);
        box-shadow: 0 0 40px rgba(251, 191, 36, 0.6);
      }

      .token.hit {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        transform: scale(1.15);
      }

      body.light-mode .token.active {
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: #1e293b;
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
      }

      body.light-mode .token.hit {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
      }

      body.light-mode .token.miss {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
        box-shadow: 0 0 15px rgba(239, 68, 68, 0.4);
      }

      body.light-mode .token.success {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
      }

      .token.miss {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
        transform: scale(1.15) rotate(-5deg);
      }

      .token.success {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        animation: celebrate 0.8s;
      }

      @keyframes celebrate {
        0%,
        100% {
          transform: scale(1);
        }
        25% {
          transform: scale(1.3) rotate(10deg);
        }
        75% {
          transform: scale(1.3) rotate(-10deg);
        }
      }

      .broadcast {
        padding: 24px 32px;
        background: linear-gradient(
          135deg,
          rgba(139, 92, 246, 0.1),
          rgba(236, 72, 153, 0.1)
        );
        border-left: 4px solid #8b5cf6;
        border-radius: 20px;
        text-align: center;
        font-weight: 600;
        font-size: 1.1rem;
        margin: 40px 0;
      }

      .insight {
        padding: 32px;
        background: linear-gradient(
          135deg,
          rgba(236, 72, 153, 0.1),
          rgba(59, 130, 246, 0.1)
        );
        border-radius: 25px;
        border: 1px solid rgba(236, 72, 153, 0.2);
      }

      body.light-mode .insight {
        background: linear-gradient(
          135deg,
          rgba(236, 72, 153, 0.15),
          rgba(59, 130, 246, 0.15)
        );
      }

      .insight h4 {
        margin-bottom: 16px;
        font-size: 1.3rem;
        font-weight: 700;
        color: #ec4899;
      }

      .insight p {
        line-height: 1.9;
        font-size: 1.05rem;
        color: #cbd5e1;
      }

      body.light-mode .insight p {
        color: #334155;
      }

      .accent {
        background: linear-gradient(
          135deg,
          rgba(251, 191, 36, 0.2),
          rgba(245, 158, 11, 0.2)
        );
        padding: 4px 10px;
        border-radius: 8px;
        font-weight: 700;
        color: #fbbf24;
      }

      body.light-mode .accent {
        color: #d97706;
        background: linear-gradient(
          135deg,
          rgba(251, 191, 36, 0.3),
          rgba(245, 158, 11, 0.3)
        );
      }

      .metrics {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 25px;
        margin-top: 40px;
      }

      .metric {
        background: linear-gradient(
          135deg,
          rgba(139, 92, 246, 0.05),
          rgba(236, 72, 153, 0.05)
        );
        padding: 32px 28px;
        border-radius: 25px;
        text-align: center;
        border: 1px solid rgba(139, 92, 246, 0.2);
        transition: all 0.4s;
        position: relative;
        overflow: hidden;
      }

      body.light-mode .metric {
        background: linear-gradient(
          135deg,
          rgba(139, 92, 246, 0.08),
          rgba(236, 72, 153, 0.08)
        );
      }

      .metric::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(139, 92, 246, 0.1),
          transparent
        );
        transition: left 0.6s;
      }

      .metric:hover::before {
        left: 100%;
      }

      .metric:hover {
        border-color: rgba(139, 92, 246, 0.5);
        transform: translateY(-8px);
        box-shadow: 0 20px 50px rgba(139, 92, 246, 0.2);
      }

      .metric-num {
        font-size: 3rem;
        font-weight: 800;
        background: linear-gradient(135deg, #8b5cf6, #ec4899);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
      }

      .metric-name {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        color: #64748b;
        font-weight: 600;
      }

      .data-section {
        margin-top: 40px;
        padding-top: 40px;
        border-top: 1px solid rgba(139, 92, 246, 0.2);
      }

      .section-head {
        font-size: 1.6rem;
        font-weight: 700;
        margin-bottom: 25px;
        color: #a78bfa;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .data-grid {
        background: rgba(139, 92, 246, 0.03);
        border-radius: 20px;
        overflow: hidden;
        border: 1px solid rgba(139, 92, 246, 0.2);
      }

      body.light-mode .data-grid {
        background: rgba(139, 92, 246, 0.05);
      }

      .data-grid table {
        width: 100%;
        border-collapse: collapse;
      }

      .data-grid th,
      .data-grid td {
        padding: 20px 24px;
        text-align: center;
        border: 1px solid rgba(139, 92, 246, 0.1);
      }

      .data-grid th {
        background: linear-gradient(
          135deg,
          rgba(139, 92, 246, 0.2),
          rgba(236, 72, 153, 0.2)
        );
        font-weight: 700;
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: #a78bfa;
      }

      .data-grid td {
        background: rgba(255, 255, 255, 0.02);
        font-family: "Courier New", monospace;
        font-weight: 700;
        font-size: 1.1rem;
      }

      body.light-mode .data-grid td {
        background: rgba(139, 92, 246, 0.03);
        color: #0f172a;
      }

      .data-grid td.spotlight {
        background: linear-gradient(
          135deg,
          rgba(251, 191, 36, 0.2),
          rgba(245, 158, 11, 0.2)
        );
        color: #fbbf24;
        border: 2px solid #fbbf24;
        font-weight: 800;
      }

      body.light-mode .data-grid td.spotlight {
        background: linear-gradient(
          135deg,
          rgba(251, 191, 36, 0.4),
          rgba(245, 158, 11, 0.4)
        );
        color: #b45309;
        border-color: #f59e0b;
        font-weight: 800;
      }

      .data-note {
        color: #94a3b8;
        margin-top: 16px;
        font-size: 0.95rem;
        line-height: 1.6;
      }

      body.light-mode .data-note {
        color: #475569;
      }

      .knowledge {
        line-height: 2;
      }

      .knowledge h3 {
        font-size: 2rem;
        font-weight: 700;
        margin-top: 40px;
        margin-bottom: 20px;
        color: #a78bfa;
      }

      .knowledge h3:first-child {
        margin-top: 0;
      }

      .knowledge p {
        margin-bottom: 18px;
        font-size: 1.1rem;
        color: #cbd5e1;
      }

      body.light-mode .knowledge p {
        color: #334155;
      }

      .knowledge strong {
        color: #8b5cf6;
        font-weight: 700;
      }

      .knowledge ul {
        margin: 20px 0;
        padding-left: 30px;
      }

      .knowledge li {
        margin-bottom: 10px;
        color: #cbd5e1;
      }

      body.light-mode .knowledge li {
        color: #334155;
      }

      .knowledge .example-box {
        background: rgba(139, 92, 246, 0.05);
        border-left: 4px solid #8b5cf6;
        padding: 20px;
        margin: 20px 0;
        border-radius: 10px;
      }

      .knowledge .example-box code {
        background: rgba(139, 92, 246, 0.1);
        padding: 2px 6px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
      }

      .indicators {
        display: flex;
        gap: 30px;
        justify-content: center;
        margin: 35px 0;
        flex-wrap: wrap;
      }

      .indicator {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 22px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 50px;
        border: 1px solid rgba(139, 92, 246, 0.2);
      }

      body.light-mode .indicator {
        background: rgba(139, 92, 246, 0.05);
      }

      .indicator-icon {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        border: 2px solid rgba(255, 255, 255, 0.3);
      }

      .indicator-icon.active {
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
      }
      .indicator-icon.hit {
        background: linear-gradient(135deg, #10b981, #059669);
      }
      .indicator-icon.miss {
        background: linear-gradient(135deg, #ef4444, #dc2626);
      }
      .indicator-icon.success {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
      }

      .indicator-label {
        font-size: 0.95rem;
        font-weight: 600;
        color: #94a3b8;
      }

      body.light-mode .indicator-label {
        color: #475569;
      }

      .match-history {
        margin-top: 30px;
        padding: 20px;
        background: rgba(139, 92, 246, 0.05);
        border-radius: 20px;
        border: 1px solid rgba(139, 92, 246, 0.2);
      }

      .match-history h4 {
        color: #a78bfa;
        margin-bottom: 15px;
        font-size: 1.2rem;
      }

      .match-item {
        padding: 10px 15px;
        margin: 8px 0;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s;
      }

      .match-item:hover {
        background: rgba(139, 92, 246, 0.1);
        transform: translateX(5px);
      }

      .match-position {
        font-weight: 700;
        color: #10b981;
        font-size: 1.1rem;
      }

      .match-text {
        color: #cbd5e1;
        font-family: "Courier New", monospace;
      }

      .hidden {
        display: none;
      }

      @media (max-width: 768px) {
        .masthead h1 {
          font-size: 2.5rem;
        }
        .dual-input {
          grid-template-columns: 1fr;
        }
        .metrics {
          grid-template-columns: repeat(2, 1fr);
        }
        .mode-selector {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="theme-switcher" onclick="toggleTheme()" aria-label="Toggle theme"></div>

    <div class="container">
      <div class="masthead">
        <h1>Pattern Match</h1>
        <p class="tagline">Next-Gen Algorithm Visualization</p>
      </div>

      <div class="mode-selector">
        <button class="mode-btn active" onclick="switchMode(0)" aria-label="Live Visualization mode">
          ‚ö° Live Visualization
        </button>
        <button class="mode-btn" onclick="switchMode(1)" aria-label="Algorithm Theory mode">
          üìñ Algorithm Theory
        </button>
      </div>

      <div class="view active" id="view0">
        <div class="panel">
          <div class="dual-input">
            <div class="field" id="textField">
              <label for="textSeq">Text Sequence</label>
              <input type="text" id="textSeq" value="ABABDABACDABABCABAB" aria-label="Text sequence input" />
              <div class="error-message">Please enter a text sequence</div>
            </div>
            <div class="field" id="patternField">
              <label for="patSeq">Pattern Target</label>
              <input type="text" id="patSeq" value="ABABCABAB" aria-label="Pattern sequence input" />
              <div class="error-message">Please enter a pattern sequence</div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="toolbar">
            <select class="algo-picker" id="algoPick" aria-label="Select algorithm">
              <option value="kmp">KMP Algorithm</option>
              <option value="bm">Boyer-Moore Algorithm</option>
            </select>
            <button class="action-btn btn-run" id="runBtn" onclick="toggleRun()" aria-label="Run visualization">
              ‚ñ∂ Run
            </button>
            <button class="action-btn btn-next" onclick="advance()" aria-label="Next step">
              ‚Üí Next
            </button>
            <button class="action-btn btn-restart" onclick="restart()" aria-label="Restart visualization">
              ‚ü≤ Restart
            </button>
            <div class="velocity-control">
              <label for="velSlider">Velocity</label>
              <input type="range" id="velSlider" min="100" max="2000" value="1000" step="100" oninput="adjustVelocity()" aria-label="Animation speed" />
              <span class="velocity-display" id="velDisplay" aria-live="polite">1.0x</span>
            </div>
          </div>
        </div>

        <div class="panel stage">
          <div class="sequence" id="textSeqDisplay" role="region" aria-label="Text sequence visualization">
            <div class="pattern-shift-indicator" id="shiftIndicator"></div>
          </div>
          <div class="sequence" id="patSeqDisplay" role="region" aria-label="Pattern sequence visualization"></div>
          <div class="broadcast" id="broadcastMsg" role="status" aria-live="polite">
            Hit Run to begin visualization
          </div>

          <div class="indicators" role="list" aria-label="Visualization indicators">
            <div class="indicator" role="listitem">
              <div class="indicator-icon active"></div>
              <span class="indicator-label">Scanning</span>
            </div>
            <div class="indicator" role="listitem">
              <div class="indicator-icon hit"></div>
              <span class="indicator-label">Match</span>
            </div>
            <div class="indicator" role="listitem">
              <div class="indicator-icon miss"></div>
              <span class="indicator-label">Mismatch</span>
            </div>
            <div class="indicator" role="listitem">
              <div class="indicator-icon success"></div>
              <span class="indicator-label">Found</span>
            </div>
          </div>

          <div class="insight">
            <h4>üí° Analysis</h4>
            <p id="insightText">
              Press Run or Next to start the pattern matching visualization
            </p>
          </div>

          <div class="metrics">
            <div class="metric">
              <div class="metric-num" id="metricStep" aria-label="Current step">0</div>
              <div class="metric-name">Step</div>
            </div>
            <div class="metric">
              <div class="metric-num" id="metricComp" aria-label="Number of comparisons">0</div>
              <div class="metric-name">Comparisons</div>
            </div>
            <div class="metric">
              <div class="metric-num" id="metricShift" aria-label="Number of shifts">0</div>
              <div class="metric-name">Shifts</div>
            </div>
            <div class="metric">
              <div class="metric-num" id="metricMatch" aria-label="Number of matches">0</div>
              <div class="metric-name">Matches</div>
            </div>
          </div>

          <div class="match-history hidden" id="matchHistory">
            <h4>üìç Match History</h4>
            <div id="matchList"></div>
          </div>

          <div class="data-section">
            <h3 class="section-head" id="dataHead">üìä LPS Array</h3>
            <div class="data-grid" id="dataDisplay"></div>
            <div class="data-note" id="dataDesc"></div>
          </div>
        </div>
      </div>

      <div class="view" id="view1">
        <div class="panel">
          <div class="knowledge" id="knowledgeContent"></div>
        </div>
      </div>
    </div>

    <script>
      let textData,
        patternData,
        algorithm,
        running = false,
        position = 0,
        steps = [];
      let velocity = 1000,
        interval = null,
        lpsData = [],
        bcData = {},
        matchHistory = [];

      function toggleTheme() {
        document.body.classList.toggle("light-mode");
        localStorage.setItem("theme", document.body.classList.contains("light-mode") ? "light" : "dark");
      }

      // Load saved theme
      if (localStorage.getItem("theme") === "light") {
        document.body.classList.add("light-mode");
      }

      function switchMode(idx) {
        document.querySelectorAll(".mode-btn").forEach((btn, i) => {
          btn.classList.toggle("active", i === idx);
        });
        document.querySelectorAll(".view").forEach((view, i) => {
          view.classList.toggle("active", i === idx);
        });
        if (idx === 1) showKnowledge();
      }

      function validateInputs() {
        let isValid = true;
        const textField = document.getElementById("textField");
        const patternField = document.getElementById("patternField");
        
        if (!document.getElementById("textSeq").value.trim()) {
          textField.classList.add("error");
          isValid = false;
        } else {
          textField.classList.remove("error");
        }
        
        if (!document.getElementById("patSeq").value.trim()) {
          patternField.classList.add("error");
          isValid = false;
        } else {
          patternField.classList.remove("error");
        }
        
        return isValid;
      }

      function showKnowledge() {
        const kmpText = `
          <h3>üîç Knuth-Morris-Pratt (KMP) Algorithm</h3>
          
          <p><strong>Time Complexity:</strong> O(n + m) - Linear time</p>
          <p><strong>Space Complexity:</strong> O(m) - For LPS array</p>
          
          <h3>üìñ How It Works</h3>
          <p>KMP algorithm is a pattern searching algorithm that uses the concept of <strong>Longest Proper Prefix which is also Suffix (LPS)</strong>. The key idea is to avoid re-examining characters that we know will match anyway.</p>
          
          <h3>üîÑ Step-by-Step Process</h3>
          <ol>
            <li><strong>Preprocessing Phase:</strong> Build the LPS array from the pattern</li>
            <li><strong>Searching Phase:</strong> Compare pattern with text using two pointers</li>
            <li><strong>On Mismatch:</strong> Use LPS array to determine how far to jump</li>
            <li><strong>On Match:</strong> Continue comparing next characters</li>
            <li><strong>Complete Match:</strong> Report position and continue searching</li>
          </ol>
          
          <h3>üí° Key Innovation</h3>
          <p>When a mismatch occurs, instead of starting from the beginning of the pattern, KMP uses the LPS array to jump to a position where the pattern might still match. This eliminates redundant comparisons.</p>
          
          <div class="example-box">
            <h4>üìù Example:</h4>
            <p>Text: <code>ABABDABACDABABCABAB</code></p>
            <p>Pattern: <code>ABABCABAB</code></p>
            <p>LPS Array: <code>[0, 0, 1, 2, 0, 1, 2, 3, 4]</code></p>
            <p>When mismatch occurs at position 5, instead of restarting from 0, we jump to position 2 based on LPS[4] = 2.</p>
          </div>
          
          <h3>‚úÖ Advantages</h3>
          <ul>
            <li>Guaranteed linear time performance</li>
            <li>No character in the text is examined more than once</li>
            <li>Excellent for patterns with repetitive substrings</li>
            <li>Ideal for streaming data where you can't go backwards</li>
          </ul>
          
          <h3>‚ùå Disadvantages</h3>
          <ul>
            <li>Requires O(m) extra space for LPS array</li>
            <li>Preprocessing time adds overhead for short texts</li>
            <li>Complex to implement correctly</li>
          </ul>
          
          <h3>üåç Real-World Applications</h3>
          <ul>
            <li><strong>Text Editors:</strong> Find and replace functionality</li>
            <li><strong>Bioinformatics:</strong> DNA sequence matching</li>
            <li><strong>Network Security:</strong> Intrusion detection systems</li>
            <li><strong>Search Engines:</strong> Pattern matching in documents</li>
          </ul>
          
          <h3>üéØ When to Use KMP</h3>
          <p>Choose KMP when:</p>
          <ul>
            <li>The pattern has many repeating characters</li>
            <li>You need guaranteed linear performance</li>
            <li>Working with streaming data</li>
            <li>Text is very large compared to pattern</li>
          </ul>
        `;

        const bmText = `
          <h3>üîç Boyer-Moore Algorithm</h3>
          
          <p><strong>Time Complexity:</strong> O(n/m) best case, O(nm) worst case</p>
          <p><strong>Space Complexity:</strong> O(k) - Where k is alphabet size</p>
          
          <h3>üìñ How It Works</h3>
          <p>Boyer-Moore is a powerful string matching algorithm that compares the pattern to the text from <strong>right to left</strong>. It uses two heuristics to determine how far to jump when a mismatch occurs.</p>
          
          <h3>üîÑ Step-by-Step Process</h3>
          <ol>
            <li><strong>Preprocessing:</strong> Build bad character table</li>
            <li><strong>Alignment:</strong> Align pattern with text</li>
            <li><strong>Comparison:</strong> Compare from rightmost character</li>
            <li><strong>On Mismatch:</strong> Use bad character rule to shift</li>
            <li><strong>On Match:</strong> Continue comparing leftwards</li>
          </ol>
          
          <h3>üí° Bad Character Rule</h3>
          <p>When a mismatch occurs at position j in the pattern with character c in the text:</p>
          <ul>
            <li>If c exists in pattern: Shift so pattern[j] aligns with rightmost c</li>
            <li>If c doesn't exist: Shift pattern past c completely</li>
          </ul>
          
          <div class="example-box">
            <h4>üìù Example:</h4>
            <p>Text: <code>HERE IS A SIMPLE EXAMPLE</code></p>
            <p>Pattern: <code>EXAMPLE</code></p>
            <p>Bad Character Table: E:6, A:5, P:4, L:2, M:1</p>
            <p>When comparing with 'S' at position 8, since 'S' is not in pattern, we can shift 7 positions to skip it entirely.</p>
          </div>
          
          <h3>‚úÖ Advantages</h3>
          <ul>
            <li>Often faster than linear time in practice</li>
            <li>Excellent with large alphabets</li>
            <li>Can skip large portions of text</li>
            <li>Best choice for long patterns</li>
          </ul>
          
          <h3>‚ùå Disadvantages</h3>
          <ul>
            <li>Worst-case O(nm) time complexity</li>
            <li>Requires space for bad character table</li>
            <li>Less effective with small alphabets</li>
            <li>Preprocessing overhead for short patterns</li>
          </ul>
          
          <h3>üåç Real-World Applications</h3>
          <ul>
            <li><strong>grep:</strong> Unix text search utility</li>
            <li><strong>Text Editors:</strong> Advanced search features</li>
            <li><strong>Plagiarism Detection:</strong> Document comparison</li>
            <li><strong>Spell Checkers:</strong> Word matching</li>
          </ul>
          
          <h3>üéØ When to Use Boyer-Moore</h3>
          <p>Choose Boyer-Moore when:</p>
          <ul>
            <li>The alphabet is large (like ASCII/Unicode)</li>
            <li>Pattern is relatively long</li>
            <li>Text contains many characters not in pattern</li>
            <li>Average-case performance is more important than worst-case</li>
          </ul>
        `;

        const algo = document.getElementById("algoPick").value;
        let content = kmpText;
        if (algo === "bm") content = bmText;
        
        document.getElementById("knowledgeContent").innerHTML = content;
      }

      function adjustVelocity() {
        velocity = parseInt(document.getElementById("velSlider").value);
        document.getElementById("velDisplay").textContent = ((2100 - velocity) / 1000).toFixed(1) + "x";
      }

      function buildLPS(seq) {
        const lps = Array(seq.length).fill(0);
        let len = 0,
          i = 1;
        while (i < seq.length) {
          if (seq[i] === seq[len]) {
            lps[i++] = ++len;
          } else {
            if (len) len = lps[len - 1];
            else lps[i++] = 0;
          }
        }
        return lps;
      }

      function buildBC(seq) {
        const map = {};
        for (let i = 0; i < seq.length; i++) {
          map[seq[i]] = i;
        }
        return map;
      }

      function createKMPSteps() {
        const result = [];
        lpsData = buildLPS(patternData);
        let i = 0,
          j = 0,
          found = [],
          comps = 0,
          shifts = 0;

        while (i < textData.length) {
          comps++;
          const match = textData[i] === patternData[j];
          const exp = match
            ? `‚úì Match: <span class="accent">${textData[i]}</span> equals <span class="accent">${patternData[j]}</span>. Advancing both pointers.`
            : `‚úó Mismatch: <span class="accent">${
                textData[i]
              }</span> ‚â† <span class="accent">${patternData[j]}</span>. ${
                j > 0
                  ? `Using LPS[${j - 1}] = ${lpsData[j - 1]} to skip.`
                  : "Moving text pointer."
              }`;

          result.push({
            txtIdx: i,
            patIdx: j,
            offset: i - j,
            comparing: true,
            match,
            msg: `Comparing text[${i}] with pattern[${j}]`,
            exp,
            comps,
            shifts,
            found: found.length,
            lpsHL: j,
          });

          if (match) {
            i++;
            j++;
          }

          if (j === patternData.length) {
            found.push(i - j);
            result.push({
              txtIdx: i - 1,
              patIdx: j - 1,
              offset: i - j,
              complete: true,
              msg: `üéâ Pattern found at index ${i - j}!`,
              exp: `<strong>Success!</strong> Complete match at position ${i - j}.`,
              comps,
              shifts,
              found: found.length,
              lpsHL: j - 1,
            });
            j = lpsData[j - 1];
            shifts++;
          } else if (i < textData.length && !match) {
            if (j !== 0) {
              shifts++;
              j = lpsData[j - 1];
            } else i++;
          }
        }
        return result;
      }

      function createBMSteps() {
        const result = [];
        bcData = buildBC(patternData);
        let s = 0,
          found = [],
          comps = 0,
          shifts = 0;
        const m = patternData.length;

        while (s <= textData.length - m) {
          let j = m - 1;

          while (j >= 0) {
            comps++;
            const txtIdx = s + j;
            const match = textData[txtIdx] === patternData[j];
            const ch = textData[txtIdx];

            const lastOcc = ch in bcData ? bcData[ch] : -1;
            const shiftAmount = Math.max(1, j - lastOcc);

            const exp = match
              ? `‚úì Match: <span class="accent">${textData[txtIdx]}</span> equals <span class="accent">${patternData[j]}</span>. Boyer-Moore scans right-to-left, continuing backward.`
              : `‚úó Mismatch: <span class="accent">${ch}</span> ‚â† <span class="accent">${
                  patternData[j]
                }</span>. ${
                  lastOcc >= 0
                    ? `Character '${ch}' last occurs at pattern[${lastOcc}]. Shift by max(1, ${j} - ${lastOcc}) = ${shiftAmount} positions.`
                    : `Character '${ch}' not in pattern. Shift by max(1, ${j} - (-1)) = ${shiftAmount} positions.`
                }`;

            result.push({
              txtIdx,
              patIdx: j,
              offset: s,
              comparing: true,
              match,
              msg: `Comparing text[${txtIdx}] with pattern[${j}]`,
              exp,
              comps,
              shifts,
              found: found.length,
              bcHL: ch,
              computedShift: shiftAmount,
              lastOcc,
            });

            if (!match) break;
            j--;
          }

          if (j < 0) {
            found.push(s);
            result.push({
              txtIdx: s,
              patIdx: 0,
              offset: s,
              complete: true,
              msg: `üéâ Pattern found at index ${s}!`,
              exp: `<strong>Success!</strong> All characters matched from right-to-left at position ${s}.`,
              comps,
              shifts,
              found: found.length,
            });
            s++;
            shifts++;
          } else {
            const ch = textData[s + j];
            const lastOcc = ch in bcData ? bcData[ch] : -1;
            const shiftAmount = Math.max(1, j - lastOcc);
            s += shiftAmount;
            shifts++;
          }
        }
        return result;
      }

      function renderLPS() {
        let html = "<table><tr><th>Index</th>";
        for (let i = 0; i < patternData.length; i++) html += `<th>${i}</th>`;
        html += "</tr><tr><th>Pattern</th>";
        for (let i = 0; i < patternData.length; i++)
          html += `<td>${patternData[i]}</td>`;
        html += "</tr><tr><th>LPS Value</th>";
        for (let i = 0; i < lpsData.length; i++) {
          const cls = steps[position]?.lpsHL === i ? ' class="spotlight"' : "";
          html += `<td${cls}>${lpsData[i]}</td>`;
        }
        html += "</tr></table>";
        document.getElementById("dataDisplay").innerHTML = html;
        document.getElementById("dataDesc").textContent =
          "LPS[i] = longest proper prefix of pattern[0..i] that is also a suffix. Enables smart skipping on mismatch.";
      }

      function renderBC() {
        const chars = Object.keys(bcData).sort();
        let html = "<table><tr><th>Character</th>";
        for (const c of chars) html += `<th>${c}</th>`;
        html += "<th>Others</th></tr><tr><th>Last Occurrence</th>";
        for (const c of chars) {
          const cls = steps[position]?.bcHL === c ? ' class="spotlight"' : "";
          const val = bcData[c];
          html += `<td${cls}>${val}</td>`;
        }
        html += `<td>-1</td></tr></table>`;
        document.getElementById("dataDisplay").innerHTML = html;
        document.getElementById("dataDesc").textContent =
          "Bad Character Table: shows last-occurrence index (rightmost) of each character in the pattern. When mismatch happens at pattern index j, shift = max(1, j - last_occurrence). Characters not in pattern have last_occurrence = -1.";
      }

      function updateMatchHistory() {
        if (matchHistory.length > 0) {
          document.getElementById("matchHistory").classList.remove("hidden");
          const matchList = document.getElementById("matchList");
          matchList.innerHTML = matchHistory.map(pos => `
            <div class="match-item">
              <span class="match-position">Position: ${pos}</span>
              <span class="match-text">${textData.substring(pos, pos + patternData.length)}</span>
            </div>
          `).join('');
        }
      }

      function visualize() {
        if (!steps.length) return;

        const step = steps[position];

        // Update pattern shift indicator
        const shiftIndicator = document.getElementById("shiftIndicator");
        if (step.offset !== undefined) {
          shiftIndicator.style.left = `${step.offset * 65 + 27.5}px`;
          shiftIndicator.style.width = `${patternData.length * 65 + (patternData.length - 1) * 10}px`;
          shiftIndicator.classList.add("active");
        }

        let txtHTML = "";
        for (let i = 0; i < textData.length; i++) {
          let cls = "token";
          if (
            step.complete &&
            i >= step.offset &&
            i < step.offset + patternData.length
          ) {
            cls += " success";
          } else if (i === step.txtIdx && step.comparing) {
            cls += step.match ? " hit" : " miss";
          } else if (i === step.txtIdx) {
            cls += " active";
          }
          txtHTML += `<div class="${cls}">${textData[i]}<div class="pos">${i}</div></div>`;
        }
        document.getElementById("textSeqDisplay").innerHTML = txtHTML + '<div class="pattern-shift-indicator" id="shiftIndicator"></div>';

        let patHTML = "";
        for (let i = 0; i < step.offset; i++) {
          patHTML += '<div class="token" style="opacity:0">.</div>';
        }
        for (let i = 0; i < patternData.length; i++) {
          let cls = "token";
          if (i === step.patIdx && step.comparing) {
            cls += step.match ? " hit" : " miss";
          }
          patHTML += `<div class="${cls}">${patternData[i]}<div class="pos">${i}</div></div>`;
        }
        document.getElementById("patSeqDisplay").innerHTML = patHTML;

        document.getElementById("broadcastMsg").textContent = step.msg;
        document.getElementById("insightText").innerHTML = step.exp;
        document.getElementById("metricStep").textContent = `${position + 1}/${steps.length}`;
        document.getElementById("metricComp").textContent = step.comps || 0;
        document.getElementById("metricShift").textContent = step.shifts || 0;
        document.getElementById("metricMatch").textContent = step.found || 0;

        if (algorithm === "kmp") renderLPS();
        else if (algorithm === "bm") renderBC();

        // Update match history when a complete match is found
        if (step.complete && step.offset !== undefined) {
          if (!matchHistory.includes(step.offset)) {
            matchHistory.push(step.offset);
            updateMatchHistory();
          }
        }
      }

      function restart() {
        if (!validateInputs()) {
          document.getElementById("broadcastMsg").textContent = "Please enter both text and pattern";
          return;
        }

        textData = document.getElementById("textSeq").value;
        patternData = document.getElementById("patSeq").value;
        algorithm = document.getElementById("algoPick").value;
        position = 0;
        running = false;
        matchHistory = [];

        if (interval) {
          clearInterval(interval);
          interval = null;
        }

        const btn = document.getElementById("runBtn");
        btn.textContent = "‚ñ∂ Run";
        btn.className = "action-btn btn-run";

        if (algorithm === "kmp") {
          steps = createKMPSteps();
          document.getElementById("dataHead").textContent = "üìä LPS Array";
        } else if (algorithm === "bm") {
          steps = createBMSteps();
          document.getElementById("dataHead").textContent = "üìä Bad Character Table";
        }

        // Hide match history initially
        document.getElementById("matchHistory").classList.add("hidden");

        if (steps.length) visualize();
        else
          document.getElementById("broadcastMsg").textContent =
            "No steps to visualize";
      }

      function toggleRun() {
        if (!steps.length) restart();

        running = !running;
        const btn = document.getElementById("runBtn");

        if (running) {
          btn.textContent = "‚è∏ Halt";
          btn.className = "action-btn btn-halt";
          interval = setInterval(() => {
            if (position < steps.length - 1) {
              position++;
              visualize();
            } else {
              toggleRun();
            }
          }, velocity);
        } else {
          btn.textContent = "‚ñ∂ Run";
          btn.className = "action-btn btn-run";
          if (interval) {
            clearInterval(interval);
            interval = null;
          }
        }
      }

      function advance() {
        if (!steps.length) restart();
        if (position < steps.length - 1) {
          position++;
          visualize();
        }
      }

      // Event listeners
      document.getElementById("textSeq").addEventListener("change", restart);
      document.getElementById("patSeq").addEventListener("change", restart);
      document.getElementById("algoPick").addEventListener("change", restart);

      // Initialize on load
      window.onload = function() {
        restart();
      };
    </script>
  </body>
</html>